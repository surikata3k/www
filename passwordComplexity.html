<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora de combinaciones y entropía de contraseñas</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="wrap">
    <h1>Calculadora de combinaciones y entropía</h1>
    <p class="lead">Selecciona los tipos de caracteres y la longitud. Calcula combinaciones, entropía, clasificación y tiempo aproximado de ataque por fuerza bruta.</p>

    <div class="grid">
        <div class="card">
            <div style="display:flex;gap:12px;margin-bottom:10px;">
                <div style="flex:1">
                    <label class="row"><span class="muted">Longitud</span>
                        <input id="length" type="number" min="1" max="10000" value="12" />
                    </label>
                </div>
                <div style="width:180px;">
                    <label class="row"><span class="muted">Velocidad</span>
                        <select id="speed">
                            <option value="1000000">CPU (≈1e6 intentos/s)</option>
                            <option value="1000000000">GPU moderna (≈1e9 intentos/s)</option>
                            <option value="10000000000" selected>Última generación doméstico (≈1e10 intentos/s)</option>
                            <option value="100000000000000">Granjas/cluster (≈1e14 intentos/s)</option>
                        </select>
                    </label>
                </div>
            </div>

            <div style="margin-bottom:8px">
                <div class="muted">Conjuntos de caracteres</div>
                <div class="sets" style="margin-top:6px">
                    <label><input id="lower" type="checkbox" checked /> minúsculas (a-z)</label>
                    <label><input id="upper" type="checkbox" checked /> MAYÚSCULAS (A-Z)</label>
                    <label><input id="numbers" type="checkbox" checked /> números (0-9)</label>
                    <label><input id="symbols" type="checkbox" /> símbolos</label>
                </div>
                <div style="margin-top:8px">
                    <div class="muted">Símbolos (editable)</div>
                    <input id="symbolsList" type="text" value="!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~" />
                </div>
            </div>

            <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
                <button id="calcBtn">Calcular</button>
                <button id="resetBtn" class="copy">Restablecer</button>
            </div>
        </div>

        <div class="card">
            <div class="out" id="results">
                <div class="stat"><div class="muted">Tamaño del conjunto de caracteres</div><div id="charsetSize">—</div></div>
                <div class="stat"><div class="muted">Combinaciones posibles</div><div id="combinations">—</div></div>
                <div class="stat"><div class="muted">Entropía</div><div id="entropy">—</div></div>

                <div>
                    <div class="muted">Clasificación</div>
                    <div id="classification" class="classification" style="margin-top:6px;background:var(--warn);">—</div>
                </div>

                <div style="margin-top:8px">
                    <div class="muted">Barra de entropía</div>
                    <div class="bar" style="margin-top:6px"><i id="entropyBar" style="width:0%;background:var(--bad)"></i></div>
                </div>

                <div style="margin-top:10px">
                    <div class="muted">Tiempo estimado para probar todas las combinaciones (peor caso)</div>
                    <div id="timeWorst" class="stat">—</div>
                    <div class="muted" style="margin-top:8px">Tiempo estimado medio (encontrar la contraseña ≈ mitad del espacio)</div>
                    <div id="timeAvg" class="stat">—</div>
                </div>

            </div>
        </div>
    </div>

    <footer>Resultados aproximados. Las velocidades son estimadas y dependen del hardware y del algoritmo.</footer>
</div>

<script>
(function(){
    const el = id => document.getElementById(id);
    const lower = el('lower'), upper = el('upper'), numbers = el('numbers'), symbols = el('symbols');
    const symbolsList = el('symbolsList'), lengthInput = el('length'), speedSel = el('speed');
    const charsetSizeOut = el('charsetSize'), combinationsOut = el('combinations'), entropyOut = el('entropy');
    const classificationOut = el('classification'), entropyBar = el('entropyBar');
    const timeWorst = el('timeWorst'), timeAvg = el('timeAvg');
    const calcBtn = el('calcBtn'), resetBtn = el('resetBtn');

    function compute() {
        const length = Math.max(1, Math.floor(Number(lengthInput.value) || 1));
        let charset = 0;
        if (lower.checked) charset += 26;
        if (upper.checked) charset += 26;
        if (numbers.checked) charset += 10;
        if (symbols.checked) {
            // Count unique chars in symbolsList
            const unique = Array.from(new Set(symbolsList.value.split('')));
            // exclude space if provided
            const filtered = unique.filter(c => c.trim() !== '');
            charset += filtered.length;
        }

        charsetSizeOut.textContent = charset || '0';

        if (!charset) {
            combinationsOut.textContent = 'Selecciona al menos un conjunto';
            entropyOut.textContent = '0 bits';
            classificationOut.textContent = 'Inseguro';
            classificationOut.style.background = 'var(--bad)';
            entropyBar.style.width = '2%'; entropyBar.style.background = 'var(--bad)';
            timeWorst.textContent = '—'; timeAvg.textContent = '—';
            return;
        }

        // Entropy (bits)
        const entropy = length * Math.log2(charset);
        entropyOut.textContent = entropy.toFixed(2) + ' bits';

        // Classification based on entropy
        let cls = '', color = '';
        if (entropy < 28) { cls = 'Muy débil'; color = 'var(--bad)'; }
        else if (entropy < 36) { cls = 'Débil'; color = 'var(--warn)'; }
        else if (entropy < 60) { cls = 'Aceptable'; color = 'orange'; }
        else if (entropy < 128) { cls = 'Fuerte'; color = 'var(--good)'; }
        else { cls = 'Muy fuerte'; color = 'teal'; }
        classificationOut.textContent = cls;
        classificationOut.style.background = color;

        // Entropy bar (map 0..128+ bits to 0..100%)
        const barPerc = Math.min(100, (entropy / 128) * 100);
        entropyBar.style.width = barPerc + '%';
        // color gradient
        if (entropy < 36) entropyBar.style.background = 'var(--bad)';
        else if (entropy < 60) entropyBar.style.background = 'var(--warn)';
        else entropyBar.style.background = 'var(--good)';

        // Combinations: show as exact BigInt when reasonable, otherwise use scientific via entropy
        // combos = charset^length -> number of possibilities
        let combosBig;
        try {
            combosBig = BigInt(Math.floor(charset)) ** BigInt(length);
            // show exact when digits <= 30
            const combosStr = combosBig.toString();
            combinationsOut.textContent = combosStr.length <= 30 ? combosStr : toScientificFromBigInt(combosBig);
        } catch (e) {
            combinationsOut.textContent = toScientificFromEntropy(entropy);
        }

        // Time estimations
        const attempts = Number(speedSel.value) || 1e10; // intentos por segundo
        // Use log10(seconds) = entropy*log10(2) - log10(attempts)
        const log10Seconds = entropy * Math.log10(2) - Math.log10(attempts);
        const worst = formatTimeFromLog10(log10Seconds);
        const avg = formatTimeFromLog10(log10Seconds - Math.log10(2)); // divide by 2 -> subtract log10(2)
        timeWorst.textContent = worst;
        timeAvg.textContent = avg;
    }

    function toScientificFromBigInt(b) {
        const s = b.toString();
        const len = s.length;
        const first = s.slice(0,6);
        return first + '… ×10^' + (len-1) + ' (' + s.length + ' dígitos)';
    }
    function toScientificFromEntropy(entropy) {
        const log10 = entropy * Math.log10(2);
        const mant = Math.pow(10, log10 - Math.floor(log10));
        return mant.toFixed(3) + ' ×10^' + Math.floor(log10);
    }

    function toHumanSeconds(n) {
        // n is Number seconds
        if (!isFinite(n)) return 'Infinito';
        if (n < 1) return (n*1000).toFixed(2) + ' ms';
        if (n < 60) return n.toFixed(2) + ' s';
        if (n < 3600) return (n/60).toFixed(2) + ' min';
        if (n < 86400) return (n/3600).toFixed(2) + ' h';
        if (n < 31536000) return (n/86400).toFixed(2) + ' días';
        const years = n / 31536000;
        if (years < 1000) return years.toFixed(2) + ' años';
        const kilo = years / 1000;
        if (kilo < 1000) return kilo.toFixed(2) + ' mil años';
        const mega = kilo / 1000;
        if (mega < 1000) return mega.toFixed(2) + ' millones de años';
        const giga = mega / 1000;
        return giga.toFixed(2) + ' mil millones de años';
    }

    function formatTimeFromLog10(log10Seconds) {
        // If log10Seconds is small, compute exact and format into s/min/h...
        if (log10Seconds < 15) {
            const seconds = Math.pow(10, log10Seconds);
            return toHumanSeconds(seconds) + ' (' + seconds.toFixed(0) + ' s)';
        }
        // Otherwise produce scientific notation + approximate years
        const yearsLog10 = log10Seconds - Math.log10(31536000);
        const yearsPower = Math.floor(yearsLog10);
        const yearsMant = Math.pow(10, yearsLog10 - yearsPower);
        const approxYears = yearsMant.toFixed(3) + '×10^' + yearsPower + ' años';
        const approxSeconds = (Math.pow(10, log10Seconds - Math.floor(log10Seconds))).toFixed(3) + '×10^' + Math.floor(log10Seconds) + ' s';
        return approxSeconds + ' ≈ ' + approxYears;
    }

    // event listeners
    calcBtn.addEventListener('click', compute);
    resetBtn.addEventListener('click', () => {
        lower.checked = true; upper.checked = true; numbers.checked = true; symbols.checked = false;
        symbolsList.value = "!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~";
        lengthInput.value = 12;
        speedSel.value = 10000000000;
        compute();
    });

    // compute on input changes
    [lower, upper, numbers, symbols, symbolsList, lengthInput, speedSel].forEach(i=>{
        i.addEventListener('input', () => { /* don't spam on every key for symbolsList; debounce maybe */ });
    });
    // simple debounce on symbolsList
    let timeout;
    symbolsList.addEventListener('input', () => { clearTimeout(timeout); timeout = setTimeout(compute, 350); });
    [lower, upper, numbers, symbols, lengthInput, speedSel].forEach(e => e.addEventListener('change', compute));

    // initial compute
    compute();
})();
</script>
</body>
</html>