<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Analizador de Contraseña</title>
  <style>
    body{font-family:Segoe UI,Arial,Helvetica,sans-serif;max-width:720px;margin:28px auto;padding:0 16px;color:#111}
    h1{font-size:1.25rem;margin-bottom:8px}
    label{display:block;margin-top:12px}
    input[type=password], input[type=text]{width:100%;padding:8px 10px;font-size:1rem;margin-top:6px;border:1px solid #ccc;border-radius:6px}
    .controls{margin-top:10px;display:flex;gap:8px}
    button{padding:8px 12px;border-radius:6px;border:1px solid #2b6cb0;background:#2b6cb0;color:#fff;cursor:pointer}
    button.secondary{background:#edf2f7;color:#111;border:1px solid #cbd5e0}
    .result{margin-top:18px;padding:12px;border-radius:8px;border:1px solid #e2e8f0;background:#fff}
    .row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #eef2f7}
    .row:last-child{border-bottom:0}
    .bar{height:12px;border-radius:8px;background:#e6e6e6;overflow:hidden;margin-top:8px}
    .bar > i{display:block;height:100%;width:0;background:linear-gradient(90deg,#f56565,#ed8936,#48bb78);transition:width .3s}
    .small{font-size:.9rem;color:#4a5568}
    .muted{color:#718096}
  </style>
</head>
<body>
  <h1>Analizador de Contraseña</h1>
  <p class="small muted">Introduce una contraseña y pulsa <strong>Analizar</strong> para obtener información detallada.</p>

  <label for="pwd">Contraseña</label>
  <input id="pwd" type="password" autocomplete="new-password" placeholder="Escribe tu contraseña aquí" />

  <div class="controls">
    <button id="analyze">Analizar</button>
    <button id="toggle" class="secondary">Mostrar</button>
    <button id="copy" class="secondary">Copiar</button>
    <label for="speed" style="margin-left:auto;align-self:center;font-size:.9rem;color:#334155">Equipo:</label>
    <select id="speed" title="Velocidad de prueba (hashes/segundo)" style="padding:8px 10px;border-radius:6px;border:1px solid #cbd5e0;background:#fff">
      <option value="100">CPU móvil — 100 H/s</option>
      <option value="1000">CPU de escritorio — 1.000 H/s</option>
      <option value="100000">CPU potente — 100.000 H/s</option>
      <option value="100000000">GPU consumidor — 100 M H/s</option>
      <option value="10000000000">Cluster/GPU pro — 10 G H/s</option>
      <option value="1000000000000">ASIC / Estado — 1 T H/s</option>
    </select>
  </div>

  <div id="output" class="result" aria-live="polite" hidden>
    <div class="row"><strong>Longitud</strong><span id="length">0</span></div>
    <div class="row"><strong>Mayúsculas</strong><span id="upper">0</span></div>
    <div class="row"><strong>Minúsculas</strong><span id="lower">0</span></div>
    <div class="row"><strong>Dígitos</strong><span id="digits">0</span></div>
    <div class="row"><strong>Símbolos</strong><span id="symbols">0</span></div>
    <div class="row"><strong>Espacios</strong><span id="spaces">0</span></div>
    <div class="row"><strong>Entropía (bits)</strong><span id="entropy">0</span></div>
    <div class="row"><strong>Fortaleza</strong><span id="strength">—</span></div>
    <div class="bar" title="Indicador de fortaleza"><i id="strengthBar"></i></div>
    <div style="margin-top:12px;border-top:1px dashed #eef2f7;padding-top:10px">
      <div class="row"><strong>Combinaciones posibles</strong><span id="combinations">—</span></div>
      <div class="row"><strong>Tiempo estimado (fuerza bruta)</strong><span id="timeEstimate">—</span></div>
    </div>
  </div>

  <script>
    const pwd = document.getElementById('pwd');
    const analyzeBtn = document.getElementById('analyze');
    const toggleBtn = document.getElementById('toggle');
    const copyBtn = document.getElementById('copy');
    const output = document.getElementById('output');
    const speedSelect = document.getElementById('speed');

    const el = id => document.getElementById(id);

    function analyze(value){
      const length = value.length;
      const upper = (value.match(/[A-Z]/g)||[]).length;
      const lower = (value.match(/[a-z]/g)||[]).length;
      const digits = (value.match(/[0-9]/g)||[]).length;
      const spaces = (value.match(/\s/g)||[]).length;
      const symbolChars = value.replace(/[A-Za-z0-9\s]/g,'');
      const symbols = symbolChars.length;

      // Determine pool size for entropy estimate
      let pool = 0;
      if(lower) pool += 26;
      if(upper) pool += 26;
      if(digits) pool += 10;
      if(symbols) pool += 32; // approximate printable symbol set

      // If nothing matches (empty), entropy is zero
      const entropy = (pool > 0 && length>0) ? Math.round(length * Math.log2(pool)) : 0;

      // log10 de combinaciones, para estimaciones grandes
      const log10Comb = (pool > 0 && length > 0) ? (length * Math.log10(pool)) : -Infinity;

      return {length,upper,lower,digits,symbols,spaces,entropy:entropy,pool,log10Comb}
    }

    function formatNumberWithSeparators(s){
      return s.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    function humanTimeFromSeconds(seconds){
      if(!isFinite(seconds) || seconds === 0) return '0 s';
      const secs = Number(seconds);
      if(secs < 60) return secs.toFixed(0) + ' s';
      if(secs < 3600) return (secs/60).toFixed(2) + ' min';
      if(secs < 3600*24) return (secs/3600).toFixed(2) + ' h';
      if(secs < 3600*24*365) return (secs/(3600*24)).toFixed(2) + ' días';
      return (secs/(3600*24*365)).toFixed(2) + ' años';
    }

    function computeCombinationsDisplay(pool, length, log10Comb){
      if(length === 0 || pool === 0) return {display:'0', exact:null, log10: -Infinity};
      const approxDigits = log10Comb;
      if(approxDigits < 21){
        try{
          const exact = BigInt(pool) ** BigInt(length);
          const s = exact.toString();
          const disp = formatNumberWithSeparators(s);
          return {display: disp, exact: s, log10: Math.log10(Number(s))};
        }catch(e){
          // fallback to approximation
        }
      }
      const power = Math.floor(approxDigits);
      const mant = Math.pow(10, approxDigits - power);
      return {display: mant.toFixed(3) + ' × 10^' + power, exact: null, log10: approxDigits};
    }

    function computeTimeEstimate(log10Comb, speed){
      if(!isFinite(log10Comb) || log10Comb === -Infinity) return '—';
      const log10Seconds = log10Comb - Math.log10(speed);
      if(log10Seconds < 15){
        const seconds = Math.pow(10, log10Seconds);
        return humanTimeFromSeconds(seconds) + ' (' + seconds.toExponential(3) + ' s)';
      }
      const yearsLog10 = log10Seconds - Math.log10(3600*24*365);
      const yearsPower = Math.floor(yearsLog10);
      const yearsMant = Math.pow(10, yearsLog10 - yearsPower);
      return '≈ ' + yearsMant.toFixed(3) + ' × 10^' + yearsPower + ' años (aprox)';
    }

    function render(info){
      el('length').textContent = info.length;
      el('upper').textContent = info.upper;
      el('lower').textContent = info.lower;
      el('digits').textContent = info.digits;
      el('symbols').textContent = info.symbols;
      el('spaces').textContent = info.spaces;
      el('entropy').textContent = info.entropy;

      // Recalcular fortaleza visual simple basada en entropía
      const bits = info.entropy;
      let strength = '—';
      let pct = 0;
      if(bits === 0){ strength = 'Muy débil'; pct = 8 }
      else if(bits < 28){ strength = 'Muy débil'; pct = 12 }
      else if(bits < 36){ strength = 'Débil'; pct = 30 }
      else if(bits < 60){ strength = 'Aceptable'; pct = 55 }
      else if(bits < 128){ strength = 'Fuerte'; pct = 80 }
      else { strength = 'Muy fuerte'; pct = 100 }
      el('strength').textContent = strength;
      document.getElementById('strengthBar').style.width = pct + '%';

      // Combinaciones y tiempo según velocidad seleccionada
      const speed = Number(speedSelect.value) || 1;
      const comb = computeCombinationsDisplay(info.pool, info.length, info.log10Comb);
      el('combinations').textContent = comb.display;
      const timeStr = computeTimeEstimate(info.log10Comb, speed);
      el('timeEstimate').textContent = timeStr;
      output.hidden = false;
    }

    analyzeBtn.addEventListener('click', ()=>{
      const v = pwd.value || '';
      const info = analyze(v);
      render(info);
    });

    toggleBtn.addEventListener('click', ()=>{
      if(pwd.type === 'password'){ pwd.type = 'text'; toggleBtn.textContent = 'Ocultar' }
      else { pwd.type = 'password'; toggleBtn.textContent = 'Mostrar' }
    });

    copyBtn.addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(pwd.value || '');
        copyBtn.textContent = 'Copiado';
        setTimeout(()=>copyBtn.textContent = 'Copiar',1200);
      }catch(e){
        copyBtn.textContent = 'No disponible';
        setTimeout(()=>copyBtn.textContent = 'Copiar',1200);
      }
    });

    // Analyze on Enter
    pwd.addEventListener('keydown', e=>{ if(e.key === 'Enter') analyzeBtn.click() });
  </script>
</body>
</html>
